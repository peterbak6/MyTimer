<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer App with Gong Sound</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        .timer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            background-color: #f2f2f2; 
            user-select: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        h1 {
            font-size: 8rem;
            color: #444;
        }
    </style>
</head>
<body>
    <div class="timer-container" id="timer">
        <h1 id="time">00:00</h1>
    </div>

    <!-- Audio file for the gong sound -->
    <audio id="gong-sound" preload="auto">
        <source src="gong.mp3" type="audio/mpeg">
        <source src="gong.ogg" type="audio/ogg">
    </audio>

     <script>
        let timer;
        let isRunning = false;
        let seconds = 0;
        let previousMinute = 0;
    
        const timerElement = document.getElementById("time");
        const timerContainer = document.getElementById("timer");
        const gongSound = document.getElementById("gong-sound");

         function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release().then(() => {
                    wakeLock = null;
                    console.log('Screen Wake Lock has been released.');
                });
            }
        }
        async function requestWakeLock() {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('Screen Wake Lock is active.');
            } catch (err) {
                console.error(`Failed to acquire wake lock: ${err.name}, ${err.message}`);
            }
        }
        // Function to play the gong sound only after user interaction
        function playGong() {
            gongSound.currentTime = 0; // Reset sound to start
            gongSound.play().catch(error => console.log('Audio playback failed:', error));
        }
    
        function updateTime() {
            const minutes = Math.floor(seconds / 60);
            const displaySeconds = seconds % 60;
    
            // Play gong sound when minutes increase
            if (minutes > previousMinute) {
                playGong(); // Play sound when minute increases
                previousMinute = minutes;
            }
    
            timerElement.textContent = 
                String(minutes).padStart(2, '0') + ':' + String(displaySeconds).padStart(2, '0');
        }
    
        function startTimer() {
            timerContainer.style.backgroundColor = '#a6d854'; // Pastel blue when running
            requestWakeLock(); // Request wake lock
            timer = setInterval(() => {
                seconds++;
                updateTime();
            }, 1000);
        }
    
        function stopTimer() {
            clearInterval(timer);
            timerContainer.style.backgroundColor = '#ffd92f'; // Pastel yellow when stopped
        }
    
        timerContainer.addEventListener("click", () => {
            // Play a silent sound initially to allow audio playback on iOS
            if (gongSound.paused) {
                playGong(); // This will unlock the audio context for iOS
            }
    
            if (!isRunning) {
                startTimer();
            } else {
                stopTimer();
            }
            isRunning = !isRunning;
        });
    
        timerContainer.addEventListener("dblclick", () => {
            stopTimer();
            seconds = 0;
            previousMinute = 0;
            updateTime();
            isRunning = false;
            timerContainer.style.backgroundColor = '#d4eacd'; // Reset to pastel green when idle
            releaseWakeLock(); // Release the wake lock on reset
        });

    
        updateTime();
        window.addEventListener('beforeunload', releaseWakeLock);
    </script>
</body>
</html>
